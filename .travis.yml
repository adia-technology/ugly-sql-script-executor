language: node_js
node_js:
- '10'
before_install:
- npm install -g typescript
- npm install -g tfx-cli
stages:
- build `
jobs:
  include:
  - stage: deploy
    if: branch = master
    script:
    - "(cd uglySqlScriptRunner && npm install && tsc)"
    - rm -rf uglySqlScriptRunner/node_modules
    - "(cd uglySqlScriptRunner && npm install --production)"
    - tfx extension create --manifest-globs vss-extension.json
    deploy:
      provider: releases
      api_key:
        secure: mJkeaCgSgVbSMwjfcxNC6yqocfT9gtv8XbqdZw0RjTktp/Dy1tP6Aznu06o9lc8ofYDTgo3QLdEpRbMlx0ziaEPHA1mpPntyOLrSp5nFRZ1Z0MJ5RZ2E85T4yS3CIBWOi3mUF9kxarbt04QX10PkVUJtE5igGjue3ngjsC+m8Ud9V4K3N+px47pUOS9/egueOy0M4wHtaShl2IXxkLN0gK424bBDPVuZWd3T0L6GSgv6WSDvzkZ7RZGvKASfsti7Yx8fEYiMyqArEzev73uURARIzsF2Uysk86E6fk1FSfIlJ3H/mN5b1coOIMlkaGN8ZFHhJV9VaivYD9ACq6efbRbkfqR6ylp3ZqQKHJI4YWe0aS2KZg7SchD2xDYf7N/hwpmLim5sirqRU7goXfFdtVUNepx9SVMVE71a6MpdVXCxcdWzmYFl+6OP6nD6J0mW3RM9Wj04DXvyf62aYF1MXq1nx3egkbvp/9KaydWTJ0U0wHVEksNymrRCahVbvVn1yyiDn+QaFcfRSAqMr/mwZtSiUS1iSA+QDUtDiOzZocyonMx1yapR+Q9pmKcmTQ37st5ySC/OXVjpZdjIi6qXj/loS8wd/sXCksPjbH0ncGKxkTzGzNNLB8H7pJeOLjamAZgmnylOc/pqHMhMvxWGnl6aroERPXpG0PolWsu17b0=
      file: "*.vsix"
      on:
        repo: adia-technology/ugly-sql-script-runner
      skip_cleanup: 'true'
